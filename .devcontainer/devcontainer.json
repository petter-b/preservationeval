{
  // A more robust image for development than the bare 'ubuntu:latest'.
  "image": "mcr.microsoft.com/devcontainers/base:ubuntu",

  "features": {
    // **FIX:** Add this feature to ensure a non-root user is created correctly.
    // This is the standard way to set up users, sudo, and basic utilities.
    "ghcr.io/devcontainers/features/common-utils:2": {
      "installSudo": true,
      "configureSudo": true,
      "username": "vscode",
      "userUid": "automatic",
      "userGid": "automatic"
    },
    
    // This feature is essential for running 'act'.
    "ghcr.io/devcontainers/features/docker-in-docker:2": {}
  },

  // 'postCreateCommand' runs after the container is created.
  // We use it here to install curl and then use curl to install act.
  "postCreateCommand": "sudo apt-get update && sudo apt-get install -y curl && curl --proto '=https' --tlsv1.2 -sSf https://raw.githubusercontent.com/nektos/act/master/install.sh | sudo bash",

  // Optional but recommended: Configure VS Code settings for the Codespace.
  "customizations": {
    "vscode": {
      "settings": {},
      "extensions": [
        "github.vscode-github-actions"
      ]
    }
  },

  // Run as the 'vscode' user, which is now guaranteed to exist by the common-utils feature.
  "remoteUser": "vscode"
}
